<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>å¸¶è–ªç”Ÿç†ä¼‘æ¯è¨ˆç®—æ©Ÿ ğŸ§»ğŸ’°</title>
<style>
:root{
  --bg:#0b0f14;
  --card:#121826;
  --card-border:#1f2937;
  --text:#e5e7eb;
  --muted:#9ca3af;
  --line:#1f2937;
  --green:#22c55e;
  --blue:#3b82f6;
  --red:#ef4444;
}
body{
  font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
  margin:0;
  background:linear-gradient(180deg,#070a10,#0b0f14);
  color:var(--text);
}
.container{
  max-width:900px;
  margin:0 auto;
  padding:16px;
}
h1{
  text-align:center;
  margin:16px 0;
  font-weight:700;
}
.card{
  background:var(--card);
  border-radius:12px;
  padding:16px;
  border:1px solid var(--card-border);
  box-shadow:0 10px 30px rgba(0,0,0,.35);
  margin-bottom:16px;
}
h2{
  margin:0 0 8px;
  font-size:18px;
}
label{
  display:block;
  font-size:14px;
  margin-bottom:4px;
  color:var(--muted);
}
input,button{
  font-family:inherit;
  font-size:14px;
}
input[type="number"],input[type="text"]{
  width:100%;
  box-sizing:border-box;
  padding:8px 10px;
  border:1px solid var(--line);
  border-radius:8px;
  background:#020617;
  color:var(--text);
}
input:focus{
  outline:none;
  border-color:#3b82f6;
}
.small{
  font-size:12px;
  color:var(--muted);
}
.notice{
  font-size:12px;
  color:#94a3b8;
  margin-top:4px;
}
.row{
  display:flex;
  gap:8px;
  flex-wrap:wrap;
}
.col{
  flex:1;
  min-width:160px;
}
button{
  border:none;
  border-radius:8px;
  padding:8px 14px;
  cursor:pointer;
  color:#fff;
}
button:hover{
  filter:brightness(1.05);
}
.btn-primary{background:var(--green);}
.btn-secondary{background:var(--blue);}
.btn-danger{background:var(--red);}
.btn-small{
  font-size:12px;
  padding:4px 8px;
}
.summary{
  font-size:15px;
  margin-top:8px;
}
.summary span{
  font-weight:bold;
  color:#facc15;
}
.table-wrapper{
  overflow-x:auto;
  margin-top:8px;
}
table{
  width:100%;
  border-collapse:collapse;
  font-size:13px;
}
th,td{
  border-bottom:1px solid var(--line);
  padding:8px;
  text-align:left;
  white-space:nowrap;
}
th{
  background:#020617;
  color:#c7d2fe;
}
.badge{
  display:inline-block;
  padding:2px 8px;
  border-radius:999px;
  font-size:11px;
  background:#1e293b;
  color:#93c5fd;
}
.timer-display{
  font-size:22px;
  font-weight:bold;
  text-align:center;
  margin:8px 0;
}
.timer-running{color:#f472b6;}
@media(max-width:600px){
  th:nth-child(5),
  td:nth-child(5){
    display:none;
  }
}
</style>
</head>
<body>
<div class="container">
<h1 id="pageTitle">ğŸ§» å¸¶è–ªç”Ÿç†ä¼‘æ¯è¨ˆç®—æ©Ÿ ğŸ’°</h1>

<!-- è–ªè³‡è¨­å®š -->
<div class="card">
<h2>1. è¨­å®šä½ çš„è–ªæ°´</h2>
<p class="small">å¯ä»¥ç›´æ¥å¡«ã€Œæ™‚è–ªã€ï¼Œæˆ–ç”¨ã€Œæœˆè–ª + ä¸Šç­å¤©æ•¸ + æ¯å¤©å·¥æ™‚ã€è‡ªå‹•ç®—ã€‚</p>
<div class="row">
<div class="col">
<label for="hourly">æ™‚è–ªï¼ˆNT$ï¼‰</label>
<input id="hourly" type="number" min="0" step="1" placeholder="ä¾‹å¦‚ï¼š183">
<div class="notice">å¦‚æœä½ çŸ¥é“è‡ªå·±çš„æ™‚è–ªï¼Œå¡«é€™å€‹å°±å¥½ã€‚</div>
</div>
<div class="col">
<label for="monthly">æœˆè–ªï¼ˆNT$ï¼‰</label>
<input id="monthly" type="number" min="0" step="1" placeholder="ä¾‹å¦‚ï¼š28000">
</div>
<div class="col">
<label for="days">æ¯æœˆä¸Šç­å¤©æ•¸</label>
<input id="days" type="number" min="1" step="1" placeholder="ä¾‹å¦‚ï¼š22">
</div>
<div class="col">
<label for="hoursPerDay">æ¯å¤©ä¸Šç­æ™‚æ•¸</label>
<input id="hoursPerDay" type="number" min="1" step="0.5" placeholder="ä¾‹å¦‚ï¼š8">
</div>
</div>
<div style="margin-top:10px;display:flex;gap:8px;align-items:center;flex-wrap:wrap;">
<button id="calcHourly" class="btn-secondary">ç”¨æœˆè–ªå¹«æˆ‘ç®—æ™‚è–ª</button>
<span class="small" id="hourlyDisplay"></span>
</div>
</div>

<!-- è¨˜éŒ„/è¨ˆæ™‚å™¨ -->
<div class="card">
<h2>2. è¨˜éŒ„ä¸€æ¬¡å¿…è¦é›¢å¸­</h2>
<div class="row">
<div class="col">
<label for="minutes">é€™æ¬¡é›¢å¸­å¹¾åˆ†é˜ï¼Ÿ</label>
<input id="minutes" type="number" min="1" step="1" placeholder="ä¾‹å¦‚ï¼š7">
<div class="notice">å¦‚æœä½ æ‡¶å¾—ç®—ï¼Œä¸‹é¢æœ‰è¨ˆæ™‚å™¨å¯ç”¨ã€‚</div>
</div>
<div class="col">
<label for="note">å‚™è¨»ï¼ˆå¯é¸ï¼‰</label>
<input id="note" type="text" maxlength="40" placeholder="ä¾‹å¦‚ï¼šæ’éšŠã€è‚šå­ç—›ã€æ»‘æ‰‹æ©Ÿ...">
<div class="notice">å‚™è¨»åªå­˜åœ¨æœ¬æ©Ÿï¼Œæ–¹ä¾¿ä½ å›æƒ³ç‚ºä»€éº¼é‚£æ¬¡æ¯”è¼ƒä¹…ã€‚</div>
</div>
</div>

<div class="row" style="margin-top:10px;">
<div class="col">
<label>æˆ–ä½¿ç”¨è¨ˆæ™‚å™¨é‡é€™æ¬¡é›¢å¸­</label>
<div class="timer-display" id="timer" data-sec="0">00:00</div>
<div style="display:flex;gap:8px;flex-wrap:wrap;justify-content:flex-start;">
<button id="startTimer" class="btn-primary">é–‹å§‹è¨ˆæ™‚</button>
<button id="stopTimer" class="btn-secondary">åœæ­¢ä¸¦åŠ å…¥ç´€éŒ„</button>
<button id="resetTimer" class="btn-danger">é‡ç½®</button>
</div>
<p class="notice">åœæ­¢å¾Œæœƒè‡ªå‹•åŠ å…¥ç´€éŒ„ï¼ˆåˆ†é˜æ•¸æœƒå‘ä¸Šå–æ•´ï¼‰ã€‚</p>
</div>
</div>

<div style="margin-top:10px;display:flex;justify-content:flex-end;gap:8px;flex-wrap:wrap;">
<button id="addSession" class="btn-primary">åŠ å…¥é€™æ¬¡ç´€éŒ„</button>
</div>
<p class="notice">âš  è¨ˆç®—çµæœåªå­˜åœ¨ä½ çš„ç€è¦½å™¨ï¼ˆlocalStorageï¼‰ï¼Œä¸æœƒä¸Šå‚³ä»»ä½•åœ°æ–¹ã€‚</p>
</div>

<!-- çµ±è¨ˆ -->
<div class="card">
<h2>3. ä»Šæ—¥çµ±è¨ˆ</h2>
<div class="summary">
ä»Šæ—¥ç¸½å…±é›¢å¸­ <span id="totalMinutes">0</span> åˆ†é˜ï¼Œç­‰æ–¼ <span id="totalMoney">0</span> å…ƒ ğŸ’°
</div>
<p class="small" id="moneyDetail"></p>

<div class="table-wrapper">
<table>
<thead>
<tr>
<th>#</th>
<th>æ™‚é–“</th>
<th>åˆ†é˜</th>
<th>æœ¬æ¬¡é‡‘é¡</th>
<th>å‚™è¨»</th>
<th>ä¾†æº</th>
<th>æ“ä½œ</th>
</tr>
</thead>
<tbody id="sessionBody"></tbody>
</table>
</div>

<p class="small">å°å¤–èªªæ˜å»ºè­°ç¨±ç‚ºã€Œå¿…è¦ç”Ÿç†ä¼‘æ¯ç´€éŒ„ç³»çµ±ã€ã€‚</p>

<div style="margin-top:8px;display:flex;justify-content:flex-end;">
<button id="clearAll" class="btn-danger">æ¸…ç©ºä»Šæ—¥ç´€éŒ„</button>
</div>
</div>

</div>

<script>
const LS_SETTINGS="ppc_settings_v1";
const LS_SESSIONS="ppc_sessions_v1";

const hourlyInput=document.getElementById("hourly");
const monthlyInput=document.getElementById("monthly");
const daysInput=document.getElementById("days");
const hoursPerDayInput=document.getElementById("hoursPerDay");
const calcHourlyBtn=document.getElementById("calcHourly");
const hourlyDisplay=document.getElementById("hourlyDisplay");

const minutesInput=document.getElementById("minutes");
const noteInput=document.getElementById("note");
const addSessionBtn=document.getElementById("addSession");

const totalMinutesSpan=document.getElementById("totalMinutes");
const totalMoneySpan=document.getElementById("totalMoney");
const moneyDetail=document.getElementById("moneyDetail");
const sessionBody=document.getElementById("sessionBody");
const clearAllBtn=document.getElementById("clearAll");

const timerDisplay=document.getElementById("timer");
const startTimerBtn=document.getElementById("startTimer");
const stopTimerBtn=document.getElementById("stopTimer");
const resetTimerBtn=document.getElementById("resetTimer");

let sessions=[];
let timerInterval=null;

function nowHHMM(){
  const d=new Date();
  return d.toLocaleTimeString("zh-TW",{hour:"2-digit",minute:"2-digit",hour12:false});
}

function formatTime(sec){
  const m=Math.floor(sec/60);
  const s=sec%60;
  return(String(m).padStart(2,"0")+":"+String(s).padStart(2,"0"));
}

function updateTimerDisplay(){
  const sec=parseInt(timerDisplay.getAttribute("data-sec")||"0",10);
  timerDisplay.textContent=formatTime(sec);
}

function escapeHtml(str){
  return(String(str||"").replace(/</g,"&lt;").replace(/>/g,"&gt;"));
}

function getHourlyWage(){
  const h=parseFloat(hourlyInput.value);
  if(!isNaN(h)&&h>0)return h;
  const m=parseFloat(monthlyInput.value);
  const d=parseFloat(daysInput.value);
  const hp=parseFloat(hoursPerDayInput.value);
  if(isNaN(m)||isNaN(d)||isNaN(hp)||m<=0||d<=0||hp<=0)return null;
  return m/(d*hp);
}

function saveAll(){
  const settings={
    hourly:hourlyInput.value,
    monthly:monthlyInput.value,
    days:daysInput.value,
    hoursPerDay:hoursPerDayInput.value
  };
  localStorage.setItem(LS_SETTINGS,JSON.stringify(settings));
  localStorage.setItem(LS_SESSIONS,JSON.stringify(sessions));
}

function loadAll(){
  try{
    const s=JSON.parse(localStorage.getItem(LS_SETTINGS)||"null");
    if(s){
      hourlyInput.value=s.hourly||"";
      monthlyInput.value=s.monthly||"";
      daysInput.value=s.days||"";
      hoursPerDayInput.value=s.hoursPerDay||"";
    }
  }catch(_){}
  try{
    const arr=JSON.parse(localStorage.getItem(LS_SESSIONS)||"[]");
    if(Array.isArray(arr))sessions=arr;
  }catch(_){
    sessions=[];
  }
}

function renderSummary(){
  let totalMin=0;
  sessions.forEach(s=>{totalMin+=s.minutes;});
  totalMinutesSpan.textContent=String(totalMin);

  const hourly=getHourlyWage();
  if(!hourly){
    totalMoneySpan.textContent="0";
    moneyDetail.textContent="è«‹å…ˆè¨­å®šå¥½æ™‚è–ªï¼ˆæˆ–ç”¨æœˆè–ªå¹«ä½ ç®—ï¼‰ï¼Œæ‰æœƒé¡¯ç¤ºé‡‘é¡ã€‚";
    return;
  }

  const totalHours=totalMin/60;
  const totalMoney=totalHours*hourly;
  totalMoneySpan.textContent=String(Math.round(totalMoney));
  moneyDetail.textContent="ä»¥æ™‚è–ªç´„ NT$"+hourly.toFixed(2)+" è¨ˆç®—ï¼Œä»Šæ—¥ç´¯ç©ç´„ "+totalHours.toFixed(2)+" å°æ™‚çš„å¿…è¦é›¢å¸­æ™‚é–“ã€‚";
}

function renderSessions(){
  sessionBody.innerHTML="";

  if(sessions.length===0){
    const tr=document.createElement("tr");
    tr.innerHTML='<td colspan="7" style="text-align:center;color:#777;">ä»Šå¤©é‚„æ²’æœ‰ä»»ä½•ä¸€ç­†ç´€éŒ„ã€‚</td>';
    sessionBody.appendChild(tr);
    renderSummary();
    return;
  }

  sessions.forEach((s,idx)=>{
    const tr=document.createElement("tr");
    const hourly=getHourlyWage();
    let moneyText="â€”";
    if(hourly){
      const money=(s.minutes/60)*hourly;
      moneyText="ç´„ NT$"+money.toFixed(1);
    }

    const note=escapeHtml(s.note||"");
    const src=s.fromTimer?'<span class="badge">è¨ˆæ™‚å™¨</span>':"â€”";

    tr.innerHTML=
      "<td>"+(idx+1)+"</td>"+
      "<td>"+(escapeHtml(s.time)||"â€”")+"</td>"+
      "<td>"+s.minutes+" åˆ†é˜</td>"+
      "<td>"+moneyText+"</td>"+
      "<td>"+(note?note:"â€”")+"</td>"+
      "<td>"+src+"</td>"+
      '<td><button class="btn-danger btn-small" data-index="'+idx+'">åˆªé™¤</button></td>';

    sessionBody.appendChild(tr);
  });

  renderSummary();
}

calcHourlyBtn.addEventListener("click",function(){
  const m=parseFloat(monthlyInput.value);
  const d=parseFloat(daysInput.value);
  const hp=parseFloat(hoursPerDayInput.value);
  if(isNaN(m)||isNaN(d)||isNaN(hp)||m<=0||d<=0||hp<=0){
    alert("è«‹æŠŠæœˆè–ªã€ä¸Šç­å¤©æ•¸ã€æ¯å¤©å·¥æ™‚éƒ½å¡«å¥½å†ç®—ã€‚");
    return;
  }
  const h=m/(d*hp);
  hourlyInput.value=h.toFixed(2);
  hourlyDisplay.textContent="ä¼°ç®—æ™‚è–ªç´„ NT$"+h.toFixed(2);
  renderSummary();
  saveAll();
});

addSessionBtn.addEventListener("click",function(){
  const minutes=parseInt(minutesInput.value,10);
  if(isNaN(minutes)||minutes<=0){
    alert("è«‹å¡«ä¸€å€‹æ­£å¸¸çš„åˆ†é˜æ•¸ï¼ˆè‡³å°‘ 1 åˆ†é˜ï¼‰ã€‚");
    return;
  }
  sessions.push({minutes:minutes,time:nowHHMM(),note:noteInput.value.trim(),fromTimer:false});
  minutesInput.value="";
  noteInput.value="";
  renderSessions();
  saveAll();
});

sessionBody.addEventListener("click",function(e){
  const target=e.target;
  if(target.tagName==="BUTTON"){
    const idx=parseInt(target.getAttribute("data-index"),10);
    if(!isNaN(idx)){
      if(confirm("ç¢ºå®šè¦åˆªé™¤é€™æ¬¡ç´€éŒ„å—ï¼Ÿ")){
        sessions.splice(idx,1);
        renderSessions();
        saveAll();
      }
    }
  }
});

clearAllBtn.addEventListener("click",function(){
  if(!confirm("è¦æ¸…ç©ºä»Šæ—¥æ‰€æœ‰ç´€éŒ„å—ï¼Ÿ"))return;
  sessions=[];
  renderSessions();
  saveAll();
});

startTimerBtn.addEventListener("click",function(){
  if(timerInterval!==null)return;
  timerDisplay.classList.add("timer-running");
  timerInterval=setInterval(function(){
    let sec=parseInt(timerDisplay.getAttribute("data-sec")||"0",10);
    sec++;
    timerDisplay.setAttribute("data-sec",String(sec));
    updateTimerDisplay();
  },1000);
});

stopTimerBtn.addEventListener("click",function(){
  if(timerInterval===null)return;
  clearInterval(timerInterval);
  timerInterval=null;
  timerDisplay.classList.remove("timer-running");

  const sec=parseInt(timerDisplay.getAttribute("data-sec")||"0",10);
  const min=Math.max(1,Math.ceil(sec/60));
  sessions.push({minutes:min,time:nowHHMM(),note:noteInput.value.trim(),fromTimer:true});

  noteInput.value="";
  timerDisplay.setAttribute("data-sec","0");
  updateTimerDisplay();

  renderSessions();
  saveAll();
});

resetTimerBtn.addEventListener("click",function(){
  if(timerInterval!==null){
    clearInterval(timerInterval);
    timerInterval=null;
  }
  timerDisplay.setAttribute("data-sec","0");
  updateTimerDisplay();
  timerDisplay.classList.remove("timer-running");
});

function attachAutoSave(el){
  el.addEventListener("input",function(){
    hourlyDisplay.textContent="";
    renderSummary();
    saveAll();
  });
}

hourlyInput.addEventListener("input",function(){
  renderSummary();
  saveAll();
});

[monthlyInput,daysInput,hoursPerDayInput].forEach(attachAutoSave);

(function init(){
  loadAll();
  updateTimerDisplay();
  renderSessions();
  renderSummary();
})();
</script>
</body>
</html>

